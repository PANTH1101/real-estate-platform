{% extends "base.html" %}
{% block title %}Checkout | Real Estate{% endblock %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <h1 class="h4 mb-3">Pay ₹499 to list your property</h1>
        <div class="card shadow-sm">
            <div class="card-body">
                <p class="mb-1"><strong>Property:</strong> {{ property.title }}</p>
                <p class="mb-3 text-muted small">{{ property.city }}, {{ property.state }}</p>
                <p>Listing fee: <strong>₹{{ payment.amount }}</strong></p>
                <button id="rzp-button" class="btn btn-primary w-100 mt-3">Pay with Razorpay</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
const options = {
    "key": "{{ razorpay_key_id }}",
    "amount": "{{ amount_paise }}",
    "currency": "INR",
    "name": "RealEstateHub",
    "description": "Property Listing Fee",
    "order_id": "{{ payment.razorpay_order_id }}",
    "handler": function (response){
        const form = document.createElement("form");
        form.method = "POST";
        form.action = "{% url 'payment:callback' %}";
        const csrfToken = "{{ csrf_token }}";
        const csrfInput = document.createElement("input");
        csrfInput.name = "csrfmiddlewaretoken";
        csrfInput.value = csrfToken;
        form.appendChild(csrfInput);
        ["razorpay_payment_id", "razorpay_order_id", "razorpay_signature"].forEach(function(key){
            const input = document.createElement("input");
            input.type = "hidden";
            input.name = key;
            input.value = response[key];
            form.appendChild(input);
        });
        document.body.appendChild(form);
        form.submit();
    },
    "theme": {
        "color": "#0061f2"
    }
};
document.getElementById('rzp-button').onclick = function(e){
    const rzp1 = new Razorpay(options);
    rzp1.open();
    e.preventDefault();
}
</script>
{% endblock %}


